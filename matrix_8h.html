<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Matrix-Race: matrix/matrix.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Matrix-Race
   &#160;<span id="projectnumber">v0.1</span>
   </div>
   <div id="projectbrief">A race game for the Robopoly matrix module.</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">matrix/matrix.h File Reference</div>  </div>
</div>
<div class="contents">

<p>Functions to draw stuff in the matrix buffer.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="matrix_8h__dep__incl.png" border="0" usemap="#matrix_2matrix_8hdep" alt=""/></div>
<map name="matrix_2matrix_8hdep" id="matrix_2matrix_8hdep">
<area shape="rect" id="node3" href="main_8c.html" title="A simple car race for Robopoly&#39;s LED matrix module." alt="" coords="5,80,67,107"/><area shape="rect" id="node5" href="matrix_8c.html" title="matrix/matrix.c" alt="" coords="91,80,200,107"/></map>
</div>
</div>
<p><a href="matrix_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a01814ddfd45a413b8666a758b9ef8f4e">M_OFF</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">not used  <a href="#a01814ddfd45a413b8666a758b9ef8f4e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a625f3fea32732c3fa32f6b3ddd75f905">M_RED</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Act on red buffer.  <a href="#a625f3fea32732c3fa32f6b3ddd75f905"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a80b0a7cdacdac141d4b98dafabbd0caa">M_GREEN</a>&#160;&#160;&#160;2</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Act on green buffer.  <a href="#a80b0a7cdacdac141d4b98dafabbd0caa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a48e12e9261c90421defa7c74a91d4941">M_ORANGE</a>&#160;&#160;&#160;3</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Act on both buffers.  <a href="#a48e12e9261c90421defa7c74a91d4941"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#ac06e38bd44dec45283f4e58e14a11ab9">ANODE_PORT</a>&#160;&#160;&#160;PORTA</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Anode port is active low.  <a href="#ac06e38bd44dec45283f4e58e14a11ab9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a1b69efd31faf5c07a71d692513ae3007">ANODE_DDR</a>&#160;&#160;&#160;DDRA</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a83a0bc04703c97ae283079a399a47cc1">RED_PORT</a>&#160;&#160;&#160;PORTB</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Red cathodes (active high)  <a href="#a83a0bc04703c97ae283079a399a47cc1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a900bbec351c7a1acd783a1bb9b97b11d">GREEN_PORT</a>&#160;&#160;&#160;PORTC</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Green cathodes (active high)  <a href="#a900bbec351c7a1acd783a1bb9b97b11d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#af6f3b640cb9bb9202423119ac4a10610">RED_DDR</a>&#160;&#160;&#160;DDRB</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#adddb05ced3a14154ef548ff39ce30035">GREEN_DDR</a>&#160;&#160;&#160;DDRC</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#ab798f60243a5bba94d99175e4c05d9c1">BUTTON_DDR</a>&#160;&#160;&#160;DDRD</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#ac8ba909fc8614df64040d2e12c0780e4">BUTTON_PORT</a>&#160;&#160;&#160;PORTD</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Buttons are active low!  <a href="#ac8ba909fc8614df64040d2e12c0780e4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#abc2ad14f0789907024ac765711ffd3da">BUTTON_PIN</a>&#160;&#160;&#160;PIND</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a4aea8f880b2ade2327bbdabf6ec099ba">BTN_1</a>&#160;&#160;&#160;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a07a21ca3fb839836109b8ac0055a4db9">BTN_2</a>&#160;&#160;&#160;3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a8c6fbf245e6091e94417fc0c70a30aa6">BTN_3</a>&#160;&#160;&#160;6</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#ade88d0a15c0b0e33de11b941f53deb75">BTN_4</a>&#160;&#160;&#160;7</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a93dcc9119e26b21a1baf894b31973e42">BUTTON_PRESSED</a>(button)&#160;&#160;&#160;((BUTTON_PIN &amp; _BV(button)) == 0)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a24a2e20d62ec1206c2833f140720d852">init_matrix</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a69259b2d664eefc2c476f7bc334e919d">matrix_clear</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears entire buffer.  <a href="#a69259b2d664eefc2c476f7bc334e919d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a5a28f10819ed671455227f505a04ed81">matrix_set_line</a> (uint8_t line_id, uint8_t values, uint8_t colour)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the pixels of a given line.  <a href="#a5a28f10819ed671455227f505a04ed81"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#aad3d0f4acb79e8a9b61eda59dc3a12b2">matrix_test</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">temporary test function  <a href="#aad3d0f4acb79e8a9b61eda59dc3a12b2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="matrix_8h.html#a2e177ede912420218593e39341fe7299">switch_buffers</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch buffers around.  <a href="#a2e177ede912420218593e39341fe7299"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Functions to draw stuff in the matrix buffer. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Andrew Watson (<a href="mailto:andy@watsons.ch">andy@watsons.ch</a>) </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2011-10-24 </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>0.1</dd></dl>
<p>What do we want to be able to do?</p>
<ol type="1">
<li>Use function 5 (bitmask) for the low level part.</li>
<li>Clear the whole matrix</li>
<li>Clear only one colour</li>
<li>Set a pixel to a given colour, regardless of what colour it is</li>
<li>Toggle a pixel (green/off, red/off, red/green)<ol type="a">
<li>What happens if a pixel is green and we want to toggle red-off?</li>
<li>Does it go green-red-off-red, green-off-red-off or green-orange..?</li>
</ol>
</li>
<li>Bitmasks on a line (and, or, xor)<ol type="a">
<li>one mask for green, one mask for red</li>
</ol>
</li>
<li>read pixels of a line (red or green), returns uint8</li>
<li>read a pixel (returns OFF, RED, GREEN)</li>
<li>optional : provide the same functionality as lines on the columns</li>
<li>to think about : do this directly, or double-buffer? </li>
</ol>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a1b69efd31faf5c07a71d692513ae3007"></a><!-- doxytag: member="matrix.h::ANODE_DDR" ref="a1b69efd31faf5c07a71d692513ae3007" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ANODE_DDR&#160;&#160;&#160;DDRA</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac06e38bd44dec45283f4e58e14a11ab9"></a><!-- doxytag: member="matrix.h::ANODE_PORT" ref="ac06e38bd44dec45283f4e58e14a11ab9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ANODE_PORT&#160;&#160;&#160;PORTA</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Anode port is active low. </p>

</div>
</div>
<a class="anchor" id="a4aea8f880b2ade2327bbdabf6ec099ba"></a><!-- doxytag: member="matrix.h::BTN_1" ref="a4aea8f880b2ade2327bbdabf6ec099ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BTN_1&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a07a21ca3fb839836109b8ac0055a4db9"></a><!-- doxytag: member="matrix.h::BTN_2" ref="a07a21ca3fb839836109b8ac0055a4db9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BTN_2&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8c6fbf245e6091e94417fc0c70a30aa6"></a><!-- doxytag: member="matrix.h::BTN_3" ref="a8c6fbf245e6091e94417fc0c70a30aa6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BTN_3&#160;&#160;&#160;6</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ade88d0a15c0b0e33de11b941f53deb75"></a><!-- doxytag: member="matrix.h::BTN_4" ref="ade88d0a15c0b0e33de11b941f53deb75" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BTN_4&#160;&#160;&#160;7</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab798f60243a5bba94d99175e4c05d9c1"></a><!-- doxytag: member="matrix.h::BUTTON_DDR" ref="ab798f60243a5bba94d99175e4c05d9c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUTTON_DDR&#160;&#160;&#160;DDRD</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abc2ad14f0789907024ac765711ffd3da"></a><!-- doxytag: member="matrix.h::BUTTON_PIN" ref="abc2ad14f0789907024ac765711ffd3da" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUTTON_PIN&#160;&#160;&#160;PIND</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac8ba909fc8614df64040d2e12c0780e4"></a><!-- doxytag: member="matrix.h::BUTTON_PORT" ref="ac8ba909fc8614df64040d2e12c0780e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUTTON_PORT&#160;&#160;&#160;PORTD</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Buttons are active low! </p>

</div>
</div>
<a class="anchor" id="a93dcc9119e26b21a1baf894b31973e42"></a><!-- doxytag: member="matrix.h::BUTTON_PRESSED" ref="a93dcc9119e26b21a1baf894b31973e42" args="(button)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUTTON_PRESSED</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">button</td><td>)</td>
          <td>&#160;&#160;&#160;((BUTTON_PIN &amp; _BV(button)) == 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Tells you if <em>button</em> is currently pressed</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if true, 0 otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="adddb05ced3a14154ef548ff39ce30035"></a><!-- doxytag: member="matrix.h::GREEN_DDR" ref="adddb05ced3a14154ef548ff39ce30035" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GREEN_DDR&#160;&#160;&#160;DDRC</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a900bbec351c7a1acd783a1bb9b97b11d"></a><!-- doxytag: member="matrix.h::GREEN_PORT" ref="a900bbec351c7a1acd783a1bb9b97b11d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GREEN_PORT&#160;&#160;&#160;PORTC</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Green cathodes (active high) </p>

</div>
</div>
<a class="anchor" id="a80b0a7cdacdac141d4b98dafabbd0caa"></a><!-- doxytag: member="matrix.h::M_GREEN" ref="a80b0a7cdacdac141d4b98dafabbd0caa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_GREEN&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Act on green buffer. </p>

</div>
</div>
<a class="anchor" id="a01814ddfd45a413b8666a758b9ef8f4e"></a><!-- doxytag: member="matrix.h::M_OFF" ref="a01814ddfd45a413b8666a758b9ef8f4e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_OFF&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>not used </p>

</div>
</div>
<a class="anchor" id="a48e12e9261c90421defa7c74a91d4941"></a><!-- doxytag: member="matrix.h::M_ORANGE" ref="a48e12e9261c90421defa7c74a91d4941" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_ORANGE&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Act on both buffers. </p>

</div>
</div>
<a class="anchor" id="a625f3fea32732c3fa32f6b3ddd75f905"></a><!-- doxytag: member="matrix.h::M_RED" ref="a625f3fea32732c3fa32f6b3ddd75f905" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_RED&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Act on red buffer. </p>

</div>
</div>
<a class="anchor" id="af6f3b640cb9bb9202423119ac4a10610"></a><!-- doxytag: member="matrix.h::RED_DDR" ref="af6f3b640cb9bb9202423119ac4a10610" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RED_DDR&#160;&#160;&#160;DDRB</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a83a0bc04703c97ae283079a399a47cc1"></a><!-- doxytag: member="matrix.h::RED_PORT" ref="a83a0bc04703c97ae283079a399a47cc1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RED_PORT&#160;&#160;&#160;PORTB</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Red cathodes (active high) </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a24a2e20d62ec1206c2833f140720d852"></a><!-- doxytag: member="matrix.h::init_matrix" ref="a24a2e20d62ec1206c2833f140720d852" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_matrix </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets port directions</p>
<p>We want an 800Hz interrupt. in the documentation, Foc refers to the frequency of the output waveform. Since the output is toggled at every compare, the actual interrupt frequency is twice the frequency of the output compare waveform. Therefore, we only need foc = 400. </p>
<div class="fragment"><pre class="fragment">

                 fclkio
 foc_nx = -------------------
          2 * N * (1 + OCRnx)
 
  </pre></div><p>with fclkio = 14745600, we get <code>N</code> = 64 (prescaler) and <code>OCRnx</code> = 71 (compare value) </p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">/*</span>
<span class="comment">     * set up I/O : LEDs as outputs, buttons as inputs</span>
<span class="comment">     */</span>
    <a class="code" href="matrix_8h.html#a1b69efd31faf5c07a71d692513ae3007">ANODE_DDR</a> = 0xFF;
    <a class="code" href="matrix_8h.html#af6f3b640cb9bb9202423119ac4a10610">RED_DDR</a> = 0xFF;
    <a class="code" href="matrix_8h.html#adddb05ced3a14154ef548ff39ce30035">GREEN_DDR</a> = 0xFF;
    <a class="code" href="matrix_8h.html#ab798f60243a5bba94d99175e4c05d9c1">BUTTON_DDR</a> = 0x00;

    <span class="comment">/*</span>
<span class="comment">     * set up an 800 Hz timer to refresh lines.</span>
<span class="comment">     */</span>
    TCCR0A = (0b10 &lt;&lt; WGM00);   <span class="comment">// Clear timer on compare, OCR0A</span>
    TCCR0B = (0 &lt;&lt; WGM02);
    TCCR0B = (0b100&lt;&lt;CS00);     <span class="comment">// Prescaler = 64</span>
    OCR0A  = 71;                <span class="comment">// Top limit for timer</span>
    TCNT0 = 0;                  <span class="comment">// Just to make sure.</span>

    TIMSK0 |= (1&lt;&lt;OCIE0A);      <span class="comment">// Enable compare interrupt on timer 0 A</span>

    sei();                      <span class="comment">// Enable global interrupts</span>


    <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a69259b2d664eefc2c476f7bc334e919d"></a><!-- doxytag: member="matrix.h::matrix_clear" ref="a69259b2d664eefc2c476f7bc334e919d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void matrix_clear </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clears entire buffer. </p>
<div class="fragment"><pre class="fragment">{
    uint8_t i;
    <span class="keywordflow">for</span>(i=0; i&lt;8; i++)
    {
        <a class="code" href="matrix_8c.html#a2a2f62689c9e08fd4cca02b78f384cb7">_red_buffer</a>[<a class="code" href="matrix_8c.html#aa327f246be5e5bbcf38e1f834955192b">draw_buffer</a>][i] = 0;
        <a class="code" href="matrix_8c.html#aebcf98832a09195d63942c672f4e8143">_green_buffer</a>[<a class="code" href="matrix_8c.html#aa327f246be5e5bbcf38e1f834955192b">draw_buffer</a>][i] = 0;
    }
    <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a5a28f10819ed671455227f505a04ed81"></a><!-- doxytag: member="matrix.h::matrix_set_line" ref="a5a28f10819ed671455227f505a04ed81" args="(uint8_t line_id, uint8_t values, uint8_t colour)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void matrix_set_line </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>line_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>colour</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the pixels of a given line. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">line_id</td><td>Matrix line (0 = bottom, 7 = top) </td></tr>
    <tr><td class="paramname">values</td><td>One byte containing pixel values </td></tr>
    <tr><td class="paramname">colour</td><td>Can be either M_RED, M_RED or M_ORANGE </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// since orange == 3, this covers all cases</span>
    <span class="keywordflow">if</span>(colour &amp; <a class="code" href="matrix_8h.html#a625f3fea32732c3fa32f6b3ddd75f905" title="Act on red buffer.">M_RED</a>)
    {
        <a class="code" href="matrix_8c.html#a2a2f62689c9e08fd4cca02b78f384cb7">_red_buffer</a>[<a class="code" href="matrix_8c.html#aa327f246be5e5bbcf38e1f834955192b">draw_buffer</a>][line_id] = values;
    }
    <span class="keywordflow">if</span>(colour &amp; <a class="code" href="matrix_8h.html#a80b0a7cdacdac141d4b98dafabbd0caa" title="Act on green buffer.">M_GREEN</a>)
    {
        <a class="code" href="matrix_8c.html#aebcf98832a09195d63942c672f4e8143">_green_buffer</a>[<a class="code" href="matrix_8c.html#aa327f246be5e5bbcf38e1f834955192b">draw_buffer</a>][line_id] = values;
    }
    <span class="keywordflow">return</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aad3d0f4acb79e8a9b61eda59dc3a12b2"></a><!-- doxytag: member="matrix.h::matrix_test" ref="aad3d0f4acb79e8a9b61eda59dc3a12b2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void matrix_test </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>temporary test function </p>

</div>
</div>
<a class="anchor" id="a2e177ede912420218593e39341fe7299"></a><!-- doxytag: member="matrix.h::switch_buffers" ref="a2e177ede912420218593e39341fe7299" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void switch_buffers </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Switch buffers around. </p>
<p>You might want to be careful when calling this function, to do it at the end of a frame, to avoid glitches. </p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="matrix_8c.html#a956716875b19cb3e39028050665c4981">_active_buffer</a> ^= 1;
}
</pre></div>
</div>
</div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Oct 24 2011 19:18:27 for Matrix-Race by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
